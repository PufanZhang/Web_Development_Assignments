### 《光辉编年史》数据格式说明书 v1.0

#### 一、总览



我们整个游戏的核心都围绕着 `.json` 文件。它们定义了游戏世界的一切：地图长什么样、地图上有什么东西，以及玩家与这些东西交互时会发生什么故事。

主要有三类核心数据：

1. **地图 (`maps`)**：定义一个游戏场景的宏观数据，比如背景、墙体和其中包含的物体。
2. **物体 (`objects`)**：定义了可以放置在地图上的具体实体，比如一个道具、一个NPC或是一个传送门。
3. **故事 (`stories`)**：定义了与物体交互时触发的对话、剧情分支和游戏数值变化。

------



#### 二、地图文件 (`/data/maps/*.json`)



地图文件负责“画”出整个游戏场景。它像一个大“舞台”，告诉程序这个场景叫什么、长什么样，以及上面要“摆放”哪些“道具”（物体）。

**字段说明：**

| 字段名       | 类型   | 是否必需 | 描述                                                         |
| ------------ | ------ | -------- | ------------------------------------------------------------ |
| `name`       | String | 是       | 地图的名称。比如 "起源之地"。                                |
| `background` | String | 是       | 指向地图背景图片的路径。例如 `"assets/images/map1.png"`。    |
| `walls`      | Array  | 否       | 一个包含多个“墙体”对象的数组。用于设置碰撞体积，防止玩家穿墙。 |
| `objects`    | Array  | 否       | 一个**字符串数组**，包含了所有要在这个地图上**初始加载**的物体的 **文件名（不带.json后缀）**。 |

**`walls` 内部对象结构：**

| 字段名   | 类型   | 描述                |
| -------- | ------ | ------------------- |
| `x`      | Number | 墙体左上角的X坐标。 |
| `y`      | Number | 墙体左上角的Y坐标。 |
| `width`  | Number | 墙体的宽度。        |
| `height` | Number | 墙体的高度。        |

**示例 (`map1.json`):**

```json
{
  "name": "起源之地",
  "background": "assets/images/map1.png",
  "walls": [
    { "x": 700, "y": 800, "width": 100, "height": 100 }
  ],
  "objects": [ "item_in_here01", "portal1to2", "increase_suspicion", "decrease_suspicion" ]
}
```

------



#### 三、物体文件 (`/data/objects/*.json`)



物体是地图上的核心交互元素。它可以是一个能对话的NPC、一个能捡的道具、一个传送门，甚至是一个满足特定条件才会出现的隐藏物品。

**字段说明：**

| 字段名                      | 类型    | 是否必需 | 描述                                                         |
| --------------------------- | ------- | -------- | ------------------------------------------------------------ |
| `id`                        | String  | 是       | 物体的唯一标识符，通常和文件名保持一致。例如 `"portal1to2"`。 |
| `image`                     | String  | 是       | 指向该物体图片的路径。例如 `"assets/images/portal.png"`。    |
| `x`, `y`, `width`, `height` | Number  | 是       | 物体在地图上的位置和尺寸。                                   |
| `storyKey`                  | String  | 是       | 关联的**故事文件名（不带.json后缀）**。当玩家与此物体交互时，会加载并开始这个故事。 |
| `showPrompt`                | Boolean | 否       | 是否在玩家靠近时显示交互提示（那个'E'键）。默认为 `false`。例如，`true` 表示显示，`false` 则不显示，适合做成隐藏或被动触发的物体。 |
| `teleportData`              | Object  | 否       | 如果这个物体是传送门，就需要这个字段。                       |
| `requiredValue`             | Object  | 否       | 如果这个物体只有在满足特定**玩家数值**时才**出现**，就需要这个字段。 |

**`teleportData` 对象结构：**

| 字段名               | 类型   | 描述                                    |
| -------------------- | ------ | --------------------------------------- |
| `targetMap`          | String | 目标地图的**文件名（不带.json后缀）**。 |
| `targetX`, `targetY` | Number | 玩家传送到目标地图后的坐标。            |

**`requiredValue` 对象结构：**

| 字段名       | 类型   | 描述                                                         |
| ------------ | ------ | ------------------------------------------------------------ |
| `name`       | String | 需要检查的玩家数值的名称，例如 `"suspicion"`。               |
| `comparison` | String | 比较方式。可以是 `"greaterOrEqual"` (大于等于), `"lessOrEqual"` (小于等于), 或 `"equal"` (等于)。 |
| `value`      | Number | 用于比较的阈值。                                             |

**示例 (`portal1to2.json`):**

```json
{
  "id": "portal1to2",
  "image": "assets/images/portal.png",
  "x": 800, "y": 500, "width": 80, "height": 100,
  "storyKey": "portal_story",
  "showPrompt": true,
  "teleportData": {
    "targetMap": "map2",
    "targetX": 200,
    "targetY": 400
  }
}
```

**示例 (`high_suspicion_item.json`):**

```json
{
  "id": "high_suspicion_item",
  "image": "assets/images/item_03.png",
  "x": 400, "y": 150, "width": 60, "height": 60,
  "storyKey": "high_suspicion_story",
  "showPrompt": true,
  "requiredValue": {
    "name": "suspicion",
    "comparison": "greaterOrEqual",
    "value": 200
  }
}
```



------



#### 四、故事文件 (`/data/stories/*.json`)



故事是整个游戏最有趣的部分！它是一个由多个“节点”组成的对话树，通过对话、选项和数值变化，来驱动剧情发展。

**字段说明：**

| 字段名      | 类型   | 是否必需 | 描述                                                         |
| ----------- | ------ | -------- | ------------------------------------------------------------ |
| `startNode` | String | 是       | 故事开始的节点ID。例如 `"confirm"`。                         |
| `nodes`     | Object | 是       | 包含所有故事节点的“字典”，`key` 是节点ID，`value` 是节点对象。 |

**`nodes` 内部的节点对象结构：**

| 字段名         | 类型   | 是否必需 | 描述                                                         |
| -------------- | ------ | -------- | ------------------------------------------------------------ |
| `speaker`      | String | 否       | 对话者的名字。如果是 `"旁白"`，则不显示名字。                |
| `dialogue`     | String | 是       | 当前节点显示的对话文本。                                     |
| `nextNode`     | String | 否       | 如果该节点是线性对话，此字段指向下一个节点的ID。             |
| `options`      | Array  | 否       | 如果该节点提供选项，则此字段为一个选项对象数组。**`nextNode` 和 `options` 通常不同时存在。** |
| `action`       | String | 否       | 在节点结束时触发的特殊动作。目前有 `"teleport"` 和 `"minigameFTG"`，前者用于触发传送，后者用于触发战斗小游戏。 |
| `valueChanges` | Array  | 否       | 一个包含数值变化对象的数组，用于改变玩家的属性。             |
| `scene`        | Array  | 否       | 定义当前场景需要显示哪些角色立绘。                           |

**`options` 内部的选项对象结构：**

| 字段名          | 类型   | 是否必需 | 描述                                                       |
| --------------- | ------ | -------- | ---------------------------------------------------------- |
| `text`          | String | 是       | 选项按钮上显示的文字。                                     |
| `targetNode`    | String | 是       | 点击该选项后要跳转到的节点ID。                             |
| `requiredValue` | Object | 否       | 和物体一样，但这里是控制**选项是否显示**。结构也完全相同。 |

**`valueChanges` 内部的数值变化对象结构：**

| 字段名   | 类型   | 描述                                                        |
| -------- | ------ | ----------------------------------------------------------- |
| `name`   | String | 要改变的数值名称，例如 `"suspicion"`。                      |
| `amount` | Number | 改变的量。正数表示增加，负数表示减少。例如 `100` 或 `-10`。 |

**`scene` 内部的角色对象结构：**

| 字段名   | 类型   | 描述                            |
| -------- | ------ | ------------------------------- |
| `id`     | String | 角色的唯一ID，与`speaker`对应。 |
| `sprite` | String | 指向该角色立绘图片的路径。      |

**示例 (`portal_story.json`):**

```
{
  "startNode": "confirm",
  "nodes": {
    "confirm": {
      "speaker": "旁白",
      "dialogue": "前方似乎连接着另一个区域，要现在过去吗?",
      "options": [
        { "text": "出发，前往新区域", "targetNode": "teleport_action" },
        { "text": "还是再逛逛吧", "targetNode": "stay_action" }
      ]
    },
    "teleport_action": {
      "speaker": "旁白",
      "dialogue": "你下定了决心，迈向了新的旅途。",
      "action": "teleport"
    },
    "stay_action": {
      "speaker": "旁白",
      "dialogue": "你决定暂时留在这里，继续探索一番。"
    }
  }
}
```

**示例 (`decrease_suspicion_story.json`):**

```json
{
  "startNode": "start",
  "nodes": {
    "start": {
      "speaker": "旁白",
      "dialogue": "这个紫色的物品看起来人畜无害，你感觉心情平静了一些。",
      "nextNode": "changeValue"
    },
    "changeValue": {
      "speaker": "旁白",
      "dialogue": "（怀疑度降低了。）",
      "valueChanges": [
        { "name": "suspicion", "amount": -100 }
      ]
    }
  }
}
```

